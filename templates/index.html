<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4361ee">
    <title>Anotador Universal - Qubiz.Team</title>
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Iro.js - Color Picker -->
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    
    <!-- Preconnect para mejor performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <style>
        /* Touch optimizations */
        body {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        #annotationCanvas {
            touch-action: none;
        }
    </style>
</head>
<body>
    <!-- Contenedor Principal -->
    <div class="app-container">
        
        <!-- ===== HEADER ===== -->
        <header class="app-header">
            <div class="logo">
                <i class="fas fa-edit"></i>
                <h1>Anotador Universal</h1>
            </div>
            
            <div class="user-actions">
                <input type="file" id="fileInput" accept=".pdf,.docx,.txt,.png,.jpg,.jpeg" hidden aria-label="Seleccionar archivo">
                
                <button id="selectFileBtn" class="header-btn secondary" aria-label="Subir archivo">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Subir</span>
                </button>
                
                <button id="saveBtn" class="header-btn" aria-label="Guardar anotaciones">
                    <i class="fas fa-save"></i>
                    <span>Guardar</span>
                </button>
                
                <button id="shareWhatsApp" class="header-btn" data-action="share-whatsapp" aria-label="Compartir WhatsApp" style="display:none;">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp</span>
                </button>
                
                <button id="shareEmail" class="header-btn" data-action="share-email" aria-label="Compartir Email" style="display:none;">
                    <i class="fas fa-envelope"></i>
                    <span>Email</span>
                </button>
                
                <button id="downloadBtn" class="header-btn" data-action="download" aria-label="Descargar PDF" style="display:none;">
                    <i class="fas fa-download"></i>
                    <span>Descargar</span>
                </button>
                
                <button id="deleteBtn" class="header-btn" data-action="delete" aria-label="Borrar documento" style="display:none;">
                    <i class="fas fa-trash"></i>
                    <span>Borrar</span>
                </button>
            </div>
        </header>

        <!-- ===== CONTENIDO PRINCIPAL ===== -->
        <div class="main-content">
            
            <!-- ===== BARRA DE HERRAMIENTAS (IZQUIERDA EN DESKTOP) ===== -->
            <aside class="toolbar">
                
                <!-- Herramientas de Dibujo -->
                <div class="tool-group">
                    <h4><i class="fas fa-tools"></i> Herramientas</h4>
                    <div class="tool-buttons">
                        <button class="tool-btn active" data-tool="pen" aria-label="L치piz">
                            <i class="fas fa-pen"></i>
                            <span>L치piz</span>
                        </button>
                        <button class="tool-btn" data-tool="highlighter" aria-label="Resaltador">
                            <i class="fas fa-highlighter"></i>
                            <span>Resaltador</span>
                        </button>
                        <button class="tool-btn" data-tool="text" aria-label="Texto">
                            <i class="fas fa-font"></i>
                            <span>Texto</span>
                        </button>
                        <button class="tool-btn" data-tool="eraser" aria-label="Borrador">
                            <i class="fas fa-eraser"></i>
                            <span>Borrador</span>
                        </button>
                    </div>
                </div>

                <!-- Selector de Color MEJORADO -->
                <div class="tool-group">
                    <h4><i class="fas fa-palette"></i> Selector de Color</h4>
                    
                    <!-- Vista previa compacta -->
                    <div class="color-preview-compact" id="colorPreviewCompact">
                        <div class="current-color-display" id="currentColorDisplay" style="background: #FFEB3B;"></div>
                        <div class="color-info-compact">
                            <span id="hexDisplayCompact">#FFEB3B</span>
                        </div>
                        <button class="open-picker-btn" id="openColorPickerBtn">
                            <i class="fas fa-palette"></i> Abrir Selector
                        </button>
                    </div>
                    
                    <!-- Colores r치pidos siempre visibles -->
                    <div class="color-palette-quick">
                        <div class="color-btn-mini" style="background:#FFEB3B" data-color="#FFEB3B"></div>
                        <div class="color-btn-mini" style="background:#F48FB1" data-color="#F48FB1"></div>
                        <div class="color-btn-mini" style="background:#4CAF50" data-color="#4CAF50"></div>
                        <div class="color-btn-mini" style="background:#2196F3" data-color="#2196F3"></div>
                        <div class="color-btn-mini" style="background:#000000" data-color="#000000"></div>
                        <div class="color-btn-mini" style="background:#FF5722" data-color="#FF5722"></div>
                        <div class="color-btn-mini" style="background:#9C27B0" data-color="#9C27B0"></div>
                        <div class="color-btn-mini" style="background:#00BCD4" data-color="#00BCD4"></div>
                    </div>
                </div>

                <!-- Control de Grosor -->
                <div class="tool-group">
                    <h4><i class="fas fa-ruler"></i> Grosor: <span id="brushSizeValue">3px</span></h4>
                    <input type="range" id="brushSize" min="1" max="20" value="3" aria-label="Ajustar grosor del trazo">
                </div>

                <!-- Limpiar P치gina -->
                <div class="tool-group">
                    <button id="clearAllBtn" class="tool-btn" style="color:#e53e3e; border-color:#feb2b2" aria-label="Limpiar p치gina actual">
                        <i class="fas fa-trash-alt"></i>
                        <span>Limpiar P치gina</span>
                    </button>
                </div>

                <!-- Informaci칩n del Documento -->
                <div class="tool-group" id="documentInfoPanel" style="display:none;">
                    <h4><i class="fas fa-info-circle"></i> Info</h4>
                    <div id="documentInfo" style="font-size:0.85rem; color:#666;">
                        <p id="docFilename" style="margin:0 0 8px 0;"></p>
                        <p id="docPages" style="margin:0;"></p>
                    </div>
                </div>
            </aside>

            <!-- ===== 츼REA DEL DOCUMENTO ===== -->
            <main id="documentContainer" class="document-container">
                
                <!-- Prompt de Subida (Zona Gris) -->
                <div id="uploadPrompt" class="upload-prompt">
                    <div class="upload-content">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h2>Sube tu documento</h2>
                        <p>Arrastra y suelta o haz clic para seleccionar</p>
                        <p class="upload-formats">PDF, DOCX, TXT, PNG, JPG</p>
                    </div>
                </div>

                <!-- Visor del Documento -->
                <div id="documentViewer" class="document-viewer" style="display:none;">
                    
                    <!-- Info del Documento -->
                    <div class="document-info-bar">
                        <h3 id="documentTitle">Documento</h3>
                        <div class="navigation-controls">
                            <button id="prevPage" class="nav-btn" onclick="window.goToPrevPage()" aria-label="P치gina anterior">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="pageInfo" class="page-info">1/1</span>
                            <button id="nextPage" class="nav-btn" onclick="window.goToNextPage()" aria-label="P치gina siguiente">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Contenedor del Documento con Canvas de Anotaciones -->
                    <div class="doc-canvas-container">
                        <div id="textContent" class="text-content"></div>
                        <canvas id="annotationCanvas" class="annotation-canvas"></canvas>
                    </div>

                </div>
            </main>

            <!-- ===== PANEL LATERAL DERECHO (CHATBOT EN DESKTOP) ===== -->
            <aside class="sidebar-right">
                
                <!-- Chatbot -->
                <div class="panel chatbot-panel">
                    <h3><i class="fas fa-comments"></i> Chatbot</h3>
                    <div id="chatbotMessages" class="chatbot-messages"></div>
                    <div class="chatbot-input-area">
                        <input type="text" id="chatbotInput" placeholder="Haz una pregunta sobre el documento..." aria-label="Pregunta para el chatbot">
                        <button id="sendQuestionBtn" aria-label="Enviar pregunta">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <button id="clearChatBtn" class="clear-chat-btn" aria-label="Limpiar chat">
                        <i class="fas fa-broom"></i> Limpiar Chat
                    </button>
                </div>

                <!-- Lista de Documentos -->
                <div class="panel documents-panel">
                    <h3><i class="fas fa-folder-open"></i> Documentos</h3>
                    <div id="documentsList" class="documents-list">
                        <p class="no-documents">Sin documentos guardados</p>
                    </div>
                </div>

            </aside>

        </div>
    </div>

    <!-- ===== FAB BUTTONS (M칍VIL) ===== -->
    <div class="fab-container">
        <button class="fab fab-chatbot" id="fabChatbot" aria-label="Abrir chatbot">
            <i class="fas fa-comments"></i>
        </button>
        <button class="fab fab-documents" id="fabDocuments" aria-label="Abrir documentos">
            <i class="fas fa-folder-open"></i>
        </button>
    </div>

    <!-- ===== MODALES (M칍VIL) ===== -->
    
    <!-- Modal Chatbot -->
    <div class="modal" id="chatbotModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-comments"></i> Chatbot</h3>
                <button class="modal-close" id="closeChatbot" aria-label="Cerrar chatbot">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="modalChatbotMessages" class="chatbot-messages"></div>
                <div class="chatbot-input-area">
                    <input type="text" id="modalChatbotInput" placeholder="Haz una pregunta..." aria-label="Pregunta para el chatbot">
                    <button id="modalSendQuestionBtn" aria-label="Enviar pregunta">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <button id="modalClearChatBtn" class="clear-chat-btn" aria-label="Limpiar chat">
                    <i class="fas fa-broom"></i> Limpiar Chat
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Documentos -->
    <div class="modal" id="documentsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-folder-open"></i> Documentos</h3>
                <button class="modal-close" id="closeDocuments" aria-label="Cerrar documentos">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="modalDocumentsList" class="documents-list">
                    <p class="no-documents">Sin documentos guardados</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Selector de Color -->
    <div class="color-picker-modal" id="colorPickerModal">
        <div class="color-picker-modal-content">
            <div class="color-picker-modal-header">
                <h3><i class="fas fa-palette"></i> Selector de Color</h3>
                <button class="modal-close" id="closeColorPicker">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="color-picker-modal-body">
                <div id="colorPicker"></div>
                
                <div class="color-info">
                    <div class="color-preview" id="colorPreview"></div>
                    <div class="color-details">
                        <div class="color-hex">
                            <span>HEX:</span>
                            <input type="text" id="hexInput" readonly value="#FFEB3B">
                        </div>
                        <div class="color-rgb">
                            <span>RGB:</span>
                            <span id="rgbValue">255, 235, 59</span>
                        </div>
                    </div>
                </div>
                
                <button class="apply-color-btn" id="applyColorBtn">
                    <i class="fas fa-check"></i> Aplicar Color
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    
    <script>
        console.log('游 Anotador Universal cargado');
        console.log('游님 Dispositivo:', navigator.userAgent);
        console.log('游늺 Viewport:', window.innerWidth, 'x', window.innerHeight);
        console.log('游댝 DPR:', window.devicePixelRatio);
    </script>

</body>
</html>